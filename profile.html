<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Character Profile - Mmories.org</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css">
  <style>
    .roofer-glow {
      text-shadow: 0 0 10px #FFD700, 0 0 20px #FFD700, 0 0 30px #FFD700;
      color: #FFD700;
    }
    .profile-image {
      max-width: 100%;
      border-radius: 8px;
      margin-bottom: 15px;
    }
    .card-header {
      background-color: #1C0237;
      color: #FFD700;
      border-bottom: 2px solid #FFD700;
    }
  </style>
</head>
<body class="container archives-background" style="margin-top: 50px;">
  <h1 class="text-primary">Character Legacy</h1>
  <div class="card">
    <div class="card-header">
      <h2 id="characterName">Loading...</h2>
    </div>
    <div class="card-body" id="profileDetails">
      <p>Loading profile...</p>
    </div>
  </div>
  <a href="archives.html" class="back-button" style="display: inline-block; margin-top: 20px; color: #FFD700; font-family: 'Georgia', serif;">‚Üê Return to Archives</a>

  <!-- Click Sound -->
  <audio id="clickSound" src="audio/click-sound.mp3" preload="auto"></audio>

  <script type="module">
    // Import Firebase SDKs
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-database.js";

    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyBbQkQ2Sy9pMyKx68z3p_PLwTON70BS1PQ",
      authDomain: "mmories-org-live.firebaseapp.com",
      projectId: "mmories-org-live",
      storageBucket: "mmories-org-live.firebasestorage.app",
      messagingSenderId: "978660559442",
      appId: "1:978660559442:web:b874b822f391a765a4ed8b"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);

    // Load profile
    function loadProfile() {
      const urlParams = new URLSearchParams(window.location.search);
      const profileId = urlParams.get('profile');

      if (!profileId) {
        document.getElementById('profileDetails').innerHTML = '<p class="text-danger">Error: No profile ID specified.</p>';
        document.getElementById('characterName').textContent = 'Error';
        return;
      }

      const profileRef = ref(database, `profiles/${profileId}`);
      onValue(profileRef, (snapshot) => {
        const profile = snapshot.val();
        const profileDetails = document.getElementById('profileDetails');
        const characterName = document.getElementById('characterName');

        if (profile) {
          characterName.textContent = profile.characterName;
          if (profile.guild.toLowerCase() === 'roofer') {
            characterName.classList.add('roofer-glow');
          }

          // Build screenshots HTML
          const screenshotsHTML = profile.screenshotURLs && profile.screenshotURLs.length > 0
            ? profile.screenshotURLs.map(url => `<img src="${url}" alt="${profile.characterName}'s Screenshot" class="profile-image">`).join('')
            : '<p>No screenshots available.</p>';

          profileDetails.innerHTML = `
            <p><strong>Guild:</strong> ${profile.guild}</p>
            <p><strong>MMO Game:</strong> ${profile.mmoGame}</p>
            <h3>Screenshots</h3>
            ${screenshotsHTML}
          `;
        } else {
          characterName.textContent = 'Profile Not Found';
          profileDetails.innerHTML = '<p class="text-danger">Profile not found.</p>';
        }
      }, (error) => {
        console.error('Error loading profile:', error);
        document.getElementById('characterName').textContent = 'Error';
        document.getElementById('profileDetails').innerHTML = '<p class="text-danger">Error loading profile.</p>';
      });
    }

    // Click sound for interactive elements
    const clickSound = document.getElementById('clickSound');
    if (clickSound) {
      console.log('Click sound element found, src:', clickSound.src);
      clickSound.volume = 1.0;
      clickSound.muted = false;
      clickSound.load();
    } else {
      console.error('Click sound element not found!');
    }

    const clickableElements = document.querySelectorAll('button, a');
    clickableElements.forEach(element => {
      element.addEventListener('click', (event) => {
        if (clickSound) {
          console.log('Attempting to play click sound... Volume:', clickSound.volume, 'Muted:', clickSound.muted);
          clickSound.currentTime = 0;
          clickSound.play().catch(error => console.error('Click sound play failed:', error));
        } else {
          console.error('No click sound element available!');
        }
      });
    });

    // Load profile when page loads
    document.addEventListener('DOMContentLoaded', loadProfile);
  </script>
</body>
</html>